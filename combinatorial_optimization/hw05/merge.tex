\documentclass[a4paper,12pt]{article}
\usepackage{HomeWorkTemplate}
\usepackage{circuitikz}
\usepackage[shortlabels]{enumitem}
\usepackage{hyperref}
\usepackage{tikz}
\usepackage{listings}

\def\Max{\text{بیشینه کن}}
\def\Min{\text{کمینه کن}}
\def\st{\text{\rl{که}}}

\usetikzlibrary{shapes.multipart}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tcolorbox}
\usepackage{xepersian}
\settextfont{XB Niloofar}
\usetikzlibrary{arrows,automata}
\usetikzlibrary{circuits.logic.US}
\usepackage{changepage}
\newcounter{problemcounter}
\newcounter{subproblemcounter}
\setcounter{problemcounter}{1}
\setcounter{subproblemcounter}{1}
\newcommand{\problem}[1]
{
	\subsection*{
		پرسش
%		\arabic{problemcounter} 
%		\stepcounter{problemcounter}
%		\setcounter{subproblemcounter}{1}
		#1
	}
}
\newcommand{\subproblem}{
	\textbf{\harfi{subproblemcounter})}\stepcounter{subproblemcounter}
}


\begin{document}
\handout
{بهینه‌سازی ترکیبیاتی مقدماتی}
{مرتضی علیمی، هانی احمد زاده}
{بهار 1400}
{اطلاعیه}
{سروش زارع}
{97100405}
 {تمرین تحویلی 5}
\problem{1}
در ابتدا فرض می‌کنیم که مواردی مانند دور با ظرفیت بی نهایت و مجموع هزینه‌های منفی وجود ندارد، زیرا در غیر این صورت مساله جواب بهینه ندارد.
\lemma{می‌توانیم یک ماتریس $U$ با درایه‌های ثابت $u$ پیدا کنیم به طوری که افزودن قید $f \leq U$ جواب‌های مساله را عوض نکند.}
\proof{}
می‌توانیم با استفاده از الگوریتمی شبیه به باینری سرچ مقدار $u$ را پیدا کنیم. در ابتدا قرار می‌دهیم $u=1$ و جواب بهینه‌ی مساله را پیدا می‌کنیم، سپس در هر مرحله $u$ را دو برابر می‌کنیم، اگر جواب بهینه‌ی مساله عوض نشد، همین $u$ را به عنوان درایه‌های $U$
در قید
$f \leq U$ 
درنظر می‌گیریم. ولی اگر جواب تغییر کرد، همین الگوریتم را ادامه می‌دهیم. با فرض اینکه مساله یک جواب بهینه دارد، این الگوریتم پس از تعدادی تکرار متوقف می‌شود، در نتیجه لم (۱) اثبات می شود. 
\begin{latin}
	$\square$
\end{latin}
پس تا کنون مساله‌ای به شکل زیر داریم:

\begin{align*}
\text{\Min} &\quad  c^T f\\
\text{\st} &\quad  0 \leq f \leq U \\
&\quad \nabla(f)_i = b_i \quad \forall i \in V
\end{align*}

حال سعی می‌کنیم هزینه ها‌ی منفی را از بین ببریم. برای این کار، در ابتدا به ازای هر یال $e=xy$ با $c_e$ منفی، مقادیر
$b_x$
و 
$b_y$
را به شکل زیر آپدیت می‌کنیم:
\begin{align*}
	b_x += u \\
	b_y -= u \\
\end{align*}
خود یال $e$ را حذف می‌کنیم و یک یال $e'=yx$ را با هزینه‌ی
$|c_e| = -c_e$
و شار اولیه‌ی ۰ اضافه می‌کنیم.
این آپدیت را به ازای تمام یال‌های با هزینه‌ی منفی انجام می‌دهیم تا در نهایت هیچ هزینه‌ی منفی باقی نمانده باشد.
نحوه‌ی این مدل سازی به این گونه است که به ازای یک یال $e=xy$ با هزینه‌ی منفی، با عوض کردن $b_x$ و $b_u$ فرض مي‌کنیم که تمام ظرفیت این یال استفاده شده است، ولی این شانس را به الگوریتم می‌دهیم که بتواند از تمام این ظرفیت استفاده نکند (با قرار دادن یال برعکس $e'$ از $y$ به $x$ با هزینه‌ی مثبت). در واقع تمام هزینه‌های منفی را در ابتدا لحاظ می‌کنیم و صرفا در صورت نیاز برخی از آن ها را بعدا کنسل می‌کنیم.
در نهایت اگر مقدار $b$ آپدیت شده را با $b'$ نشان دهیم و هزینه‌ها را با $c'$ نشان دهیم، کافیست مساله‌ی زیر را حل کنیم:
\begin{align*}
\text{\Min} &\quad  c'^T f\\
\text{\st} &\quad  0 \leq f \leq U \\
&\quad \nabla(f)_i = b_i' \quad \forall i \in V
\end{align*}
اگر جواب بهینه‌ی این مساله را با $f^*$ نشان دهیم، برای به دست آوردن جواب مساله‌ی اصلی، برای یال‌های $e$ که از همان ابتدا هزینه‌ی مثبت داشته‌اند کافیست همان $f^*_e$ را برای $f_e$ در نظر بگیریم و برای یال‌های $e$ که در ابتدا هزینه‌ی منفی داشته‌اند،  کافیست $f_e$ را برابر با 
$u - {f_e'}^*$
 قرار دهیم (چون در ابتدا فرض کردیم تمام ظرفیت  $e$ استفاده شده است ولی در نهایت  به اندازه‌ی
${f_e'}^*$
از آن را کنسل کرده‌ایم).

نکته: می‌توان دید که برای هر $v \in V$ داریم:
\begin{align*}
	b'_v = b_v + u(|\delta^+{(v)}| - |\delta^-{(v)}|)
\end{align*}



\pagebreak

\problem{2}
ابتدا برنامه‌ی اصلی ($Primal$) را می‌نویسیم:

\begin{align*}
\text{\Min} &\quad  c^T f\\
\text{\st} &\quad  0 \leq f \leq u \\
&\quad \nabla(f)_i = b_i \quad \forall i \in V
\end{align*}

حال برنامه‌ی دوگان ($Dual$) را می‌نویسیم:

\begin{align*}
\text{\Max} &\quad  b^T \pi + u^Ty  \\
\text{\st} &\quad  y_{i,j} + \pi_j - \pi_i \leq c_{i,j} \quad \forall e=ij \in E \\
&\quad y, \pi \geq 0 
\end{align*}

طبق لنگی مکمل، اگر $f^*$ یک جواب شدنی برای $P$ و مجموعه‌ی 
$B^* = \{y^*, \pi^*\}$
یک جواب شدنی برای $D$ باشند، این جواب ها بهینه اند اگر و تنها اگر داشته باشیم:
\begin{align}
	f^*_e > 0 \rightarrow {y^*}_{i,j} + \pi^*_j - \pi^*_i = c_{i,j} \\
	f^*_e < u_e \rightarrow y^*_e = 0
\end{align}
\lemma{تساوی سمت راست (۱) در صورت بهینه بودن $D$ همواره برقرار است و در واقع شرطی اضافه است.}
\proof{}
(فرض خلف) فرض کنید
$B^* = \{y^*, \pi^*\}$
یک جواب بهینه برای $D$ باشد.
اگر $i,j$ موجود باشند به طوری که داشته باشیم
\begin{align*}
{y^*}_{i,j} + \pi^*_j - \pi^*_i < c_{i,j}
\end{align*}
می‌توانیم $y_{i,j}$ را به اندازه‌ی یک $\epsilon > 0$ افزایش دهیم به طوری که همچنان قیود $D$ برقرار باشند و علاوه بر آن، با توجه به مثبت بودن ظرفیت‌ها (درایه‌های $u$)، تابع هدف نیز افزایش پیدا می‌کند که با بهینه بودن $B$ در تناقض است. پس فرض خلف باطل است و لم (۱) اثبات می‌شود.

حال با توجه به لم (۱)، می‌توانیم بنویسیم:
\begin{align*}
	{y^*}_{i,j} = c_{i,j} - \pi^*_j + \pi^*_i
\end{align*}
و در نتیجه شرط (۲) را می‌توانیم به صورت معادل زیر بنویسیم:
\begin{align*}
	\color{blue} f^*_e < u_e \rightarrow c_{i,j} - \pi^*_j + \pi^*_i = 0
\end{align*}
پس توانستیم شروط لنگی مکمل را بدون استفاده از $y^*$ بنویسیم.

\pagebreak

\problem{3}
هدفمان این است که مساله را به این شکل مدل کنیم:
\begin{align*}
\text{\Min} &\quad  c^T f\\
\text{\st} &\quad  0 \leq f\\
&\quad \nabla(f)_i = b_i \quad \forall i \in V
\end{align*}
که $c_e$ هزینه‌ی کپی گرفتن از یال $e$ می‌باشد.

حال سعی می‌کنیم مساله را طوری مدل کنیم که هر یال مجبور باشد حداقل ۱ بار استفاده شود (بدون هزینه)، و سپس به ازای هر استفاده‌ی مجدد، هزینه‌ای اضافه متحمل شود. سعی می‌کنیم این هزینه‌های اضافه را با $f$ مدل کنیم و خود $e$ اولیه را با عوض کردن $b_i$ ها مدل کنیم.
 برای این کار کافیست برای هر یال
$e=uv$
مقدار $b_u$ 
و
$b_v$
را به ترتیب با مقادیر
$b_u + 1$
و
$b_u - 1$
عوض کنیم. همین کار را به ازای تک تک یال‌ها انجام می‌دهیم و این کار عملا باعث می‌شود که هر یال حداقل یک بار استفاده شود.
برای اینکه در نهایت یک گراف اویلری داشته باشیم، کافیست کاری کنیم که $b_i$ های اولیه (قبل از عوض شدن)، همگی برابر با ۰ باشند (باعث می‌شود درجه‌ی خروجی و ورودی رئوس پس از اضافه شدن یال‌ها برابر باشد). پس کافیست در ابتدا قرار دهیم $b = 0$ و با پیمایش روی یال‌های $e \in E$، مقادیر $b$ را آپدیت کنیم. در نهایت اگر مقدار آپدیت شده‌ی $b$ را با $b'$ نشان دهیم، مساله‌ی زیر را حل می‌کنیم:
\begin{align*}
\text{\Min} &\quad  c^T f\\
\text{\st} &\quad  0 \leq f \\
&\quad \nabla(f)_i = b_i' \quad \forall i \in V
\end{align*}
در جواب بهینه‌ی به دست آمده، اگر شار استفاده شده برای یال $e$ برابر با $f_e$ باشد، این مقدار نشان می‌دهد که $f_e$ بار کپی از یال $e$ اضافه شده است (به جز خود $e$ اولیه).

نکته: می‌توان دید که برای هر $v \in V$ داریم:
\begin{align*}
	b'_v = |\delta^+{(v)}| - |\delta^-{(v)}|
\end{align*}

\end{document}
